<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" style="margin:0px; padding:0px;">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>QLand</title>
	<link rel="stylesheet" type="text/css" href="/css/questgo.css" media="all" />
	<script src="/js/jquery-1.11.2.min.js"></script>
	<script src="/js/utils.js"></script>
	<!--[if IE]>
	<style type="text/css" media="all">.borderitem {border-style: solid;}</style>
	<![endif]-->
</head>

<body id="bodyID" style="background-size: cover; margin: 0px; padding: 0px;">
	<table style="width: 100%; text-align: center; align: center;">
		<tr>
			<td style="width: 15%;">
			</td>
			<td style="width: 70%; height: 40px;">
				<table style="width: 100%; height: 100%; text-align: center; padding-top: 1%;">
					<tr style="height: 100%;">
						<td style="position: relative; width: 20%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									<a href="/Main.htm">Главная</a>
								</div>
							</div>
						</td>
						<td style="position: relative; width: 20%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									Квесты
								</div>
							</div>
						</td>
						<td style="position: relative; width: 22%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									<a href="/Popular.htm">Популярное</a>
								</div>
							</div>
						</td>
						<td style="position: relative; width: 18%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									<a href="/Authors.htm">Авторы</a>
								</div>
							</div>
						</td>
						<td style="position: relative; width: 20%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									<a href="/Rules.htm">Правила</a>
								</div>
							</div>
						</td>
					</tr>
				</table>
			</td>
			<td style="width: 15%;">
			</td>
		</tr>
		<tr>
			<td rowspan="2" style="width: 15%; vertical-align: top;">
				<div class="Txt_qland">
					Q u e s t L a n d
				</div>
			</td>
			<td style="width: 70%; padding-top: 1%; padding-bottom: 3%;">
				<div style="border-radius: 50px; box-shadow: -10px 10px 50px 15px black; background-color: #fff; height: 100%;">
					<table id="mainTable" style="height: 100%; width: 100%;">
						<tr style="width: 100%;">
							<td colspan="2" style="width: 100%; height: 50px; text-align: left;">
								<div id="capture" class="Txt_QInfo">
									Shersh/It Is Fantastic Quest!/+10/page 1
								</div>
							</td>
						</tr>
						<tr>
							<td style="width: 60%; text-align: center; padding-left: 10px; padding-right: 10px;">
								<img id="qImg" style="max-height: 400px; max-width: 550px; heigh: auto; width: auto;" src = "images/quest1_img3.jpg" alt = "quest picture"></img>
							</td>
							<td style="width: 40%; padding-left: 10px; padding-right: 10px;">
								<div id="smallDesc" class="Txt_Descr1">
									Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля.
								</div>
							</td>
						</tr>
						<tr>
							<td colspan="2" style="padding-left: 5%; padding-right: 5%; padding-top: 2%;">
								<div id="bigDesc" class="Txt_Descr2">
									Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля.
								</div>
							</td>
						</tr>
						<tr id="rbRow1">
							<td colspan="2" style="text-align: left">
								<div class="Txt_Variants"><input id="rb1" type="radio" name="group1" value="1"> Пойти вперед</div>
							</td>
						</tr>
						<tr id="rbRow2">
							<td colspan="2" style="text-align: left">
								<div class="Txt_Variants"><input id="rb2" type="radio" name="group1" value="2"> Пойти назад</div>
							</td>
						</tr>
						<tr id="rbRow3">
							<td colspan="2" style="text-align: left">
								<div class="Txt_Variants"><input id="rb3" type="radio" name="group1" value="3"> Сесть на пол и сокрушаться</div>
							</td>
						</tr>
						<tr id="rbRow4">
							<td colspan="2" style="text-align: left">
								<div class="Txt_Variants"><input id="rb4" type="radio" name="group1" value="4"> Биться головой о стену. Биться головой о стену. Биться головой о стену. И еще. И еще раз.</div>
							</td>
						</tr>
						<tr id="rbRow5">
							<td colspan="2" style="text-align: left">
								<div class="Txt_Variants"><input id="rb5" type="radio" name="group1" value="5"> Попытаться вспомнить, что произошло ранее.</div>
							</td>
						</tr>
						<tr id="buttonRow">
							<td colspan="2" style="text-align: center; padding-top: 1%; padding-bottom: 1%;">
								<button onclick="nextSituation()" style="font-size: 240%; color: #265aff; background-color: #fff; width: 20%;">Готово!</button>
							</td>
						</tr>
					</table>
				</div>
			</td>
			<td rowspan="2" style="width: 15%; text-align: center; vertical-align: top;">
				<table style="height: 510px; width: 80%; margin-left: 10%;">
					<tr>
						<td colspan="2" style="height: 22%; width: 100%; text-align: center;">
							<div id="authorImgBox">
								<img id="authorImg" src="images/author.png" alt="author pict" style="position: relative; max-height: 100px; max-width: 100px; height: auto; width: auto;"/>
							</div>
						</td>
					</tr>
					<tr>
						<td colspan="2" style="height: 10%;">
							<div id="authorName" style="font-family: 'Hobo Std', Arial, Helvetica, sans-serif; font-size: 200%;	text-align: center;	color: #fff; text-shadow: 5px 2px 3px black;
										line-height: 100%; padding-bottom: 2px; padding-top: 1px;">
								Rozettka
							</div>
						</td>
					</tr>
					<tr>
						<td colspan="2" style="height: 17%;">
							<div id="crQuest" class="auth_menu_block">
								<div class="txt_auth_menu">
									Создать <br> квест
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td colspan="2" style="height: 17%;">
							<div id="logoutUser" onclick="exitUser(url2id())" class="auth_menu_block">
								<div class="txt_auth_menu" style="padding-top: 15%;">
									Выйти
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td colspan="2" style="height: 17%;">
							<div onclick="stopQuest()" class="auth_menu_block">
								<div class="txt_auth_menu" style="padding-top: 10%;">
									Прервать <br> квест
								</div>
							</div>
						</td>
					</tr>
					<tr style="height: 17%;">
						<td style="width: 50%;">
							<div class="auth_menu_block" style="display: none;">
								<div class="Txt_QLike" style="padding-right: 0px; padding-top: 20px; text-align: center;">
									&hearts;
								</div>
							</div>
						</td>
						<td style="width: 50%;">
							<div class="auth_menu_block" style="display: none;">
								<div class="Txt_QDislike" style="padding-right: 0px; padding-bottom: 20px; text-align: center;">
									&hearts;
								</div>
							</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

<script>
	function initQuestgo() {
		$.ajax({
			type: "POST",
			url: '/quest',
			dataType: 'json',
			data: { type: 'id', value: url2id() }
		}).done(function(quest) {
			console.log("quest: " + quest);
			document.getElementById("capture").innerHTML
				= quest.author + "/" + quest.name + "/"
				+ (quest.rate > 0 ? '+' : '') + quest.rate + "/page 1";

			var fons = ["fon_fanz.png", "fon_fant.png", "fon_real.png", "fon_alter.png"];
			$("#bodyID").css("background-image", "url(/images/" + fons[quest.universeID - 1] + ")")
						.css("background-repeat", "no-repeat");
			update(0);
		});
	}

	var currentSituation = 1;
	validateLogin({"questGoExit": true});
	initQuestgo();

	function update(next) {
		$.ajax({
			type: "POST",
			url: '/questgo',
			dataType: 'json',
			data: { type: 'id', questValue: url2id(), situationValue: currentSituation, nextMove: next }
		}).done(function(situation) {
			currentSituation = situation.situationID;
			//console.log(jsonMainQuests);
			initSituation(situation);
		});
	}

	function initSituation(situation) {
		document.getElementById("qImg").setAttribute("src", "/images/" + (situation.imageURL ? "quest/" + situation.imageURL : "none.png"));
		document.getElementById("smallDesc").innerHTML = (situation.smallDescription ? situation.smallDescription : "");
		document.getElementById("bigDesc").innerHTML = (situation.bigDescription ? situation.bigDescription : "");

		var capt = document.getElementById("capture");
		var captHead = capt.innerHTML;
		captHead = captHead.substring(0, captHead.lastIndexOf(" ")) + " " + situation.situationID;
		capt.innerHTML = captHead;

		for (var i = 1; i <= 5; i++) {
			var rbRow = document.getElementById("rbRow" + i);
			if (!rbRow) break;
			rbRow.parentNode.removeChild(rbRow);
		}

		var mainTable = document.getElementById("mainTable");
		for (var i = 0; i < situation.choices.length; i++) {
			var rbRow = mainTable.insertRow(3 + i);
			rbRow.setAttribute("id", "rbRow" + (i + 1));
			var rbCell = rbRow.insertCell(0);
			rbCell.setAttribute("colspan", "2");
			rbCell.setAttribute("style", "text-align: left");
			var rbDiv = document.createElement("div");
			rbDiv.setAttribute("class", "Txt_Variants");
			var rb = document.createElement("input");
			rb.setAttribute("id", "rb" + (i + 1));
			rb.setAttribute("type", "radio");
			rb.setAttribute("name", "group1");
			rb.setAttribute("value", (i + 1).toString());
			rbDiv.innerHTML = rb.outerHTML + " " + situation.choices[i];
			rbCell.appendChild(rbDiv);
		}

		if (i == 0) {
			var rowButton = document.getElementById("buttonRow");
			rowButton.parentNode.removeChild(rowButton);
		}
	}

	function nextSituation() {
		var next = 0;
		for (var i = 1; i <= 5; i++) {
			var rb = document.getElementById("rb" + i);
			if (!rb) break;
			if (rb.checked) {
				next = i;
				break;
			}
		}

		if (next != 0) {
			update(next);
		}
	}

	function stopQuest() {
		window.location = window.location.protocol + "//" + window.location.host + "/quest/" + url2id();
	}
</script>

</body>
</html>