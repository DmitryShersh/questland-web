<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>QLand</title>
	<link rel="stylesheet" type="text/css" href="/css/author.css" media="all" />
	<script src="/js/jquery-1.11.2.min.js"></script>
	<!--[if IE]>
	<style type="text/css" media="all">.borderitem {border-style: solid;}</style>
	<![endif]-->
</head>

<body>

<div id="main">
	<div id="Div">
	</div>
	<div id="Div2">
	</div>
	<div id="Div3">
	</div>
	<div id="Div4">
	</div>
	<div id="Div5">
	</div>
	<div class="Txt_Главная">
	
		<p class="lastNode"><a href="/Main.htm">Главная</a>
		</p>
	</div>
	<div class="Txt_Популярное">
	
		<p class="lastNode">Популярное
		</p>
	</div>
	<div class="Txt_Правила">
	
		<p class="lastNode"><a href="/Rules.htm">Правила</a>
		</p>
	</div>
	<div class="Txt_Авторы">
	
		<p class="lastNode">Авторы
		</p>
	</div>
	<div class="Txt_Квесты">
	
		<p class="lastNode">Квесты
		</p>
	</div>
	<div class="clearFloat"></div>
	<div id="Div6">
	</div>
	<div class="clearFloat"></div>
	<img id="Ava" src="/images/author/author.png" alt="author image"/>
	<div class="Txt_QuestLand">
	
		<p class="lastNode">Q u e s t L a n d
		</p>
	</div>
	<div class="Txt_name">
	
		<p id="authorLogin" class="lastNode">
		</p>
	</div>
	<div class="Txt_About">
	
		<p id="authorDescription" class="lastNode">
		</p>
	</div>
	<div class="clearFloat"></div>
	<table id="whiteBackGroundTable" style="position: absolute; left: 225px; top: 700px; width: 1050px;">
		<tr style="position: relative; top: 20px; width: 1050px; height: 230px;">
			<td>
				<div id="Div7"></div>
			</td>
		</tr>
		<tr style="position: relative; top: 20px; width: 1050px; height: 230px;">
			<td>
				<div id="Div7"></div>
			</td>
		</tr>
		<tr style="position: relative; top: 20px; width: 1050px; height: 230px;">
			<td>
				<div id="Div7"></div>
			</td>
		</tr>
		<tr style="position: relative; top: 20px; width: 1050px; height: 230px;">
			<td>
				<div id="Div7"></div>
			</td>
		</tr>
	</table>
	<table id="univerTable" style="position: absolute; left: 225px; top: 700px; width: 1050px;">
		<tr style="position: relative; top: 20px; width: 1050px; height: 230px;">
			<td>
				<div id="Univer" style="background-color: #00b200;"></div>
			</td>
		</tr>
		<tr style="position: relative; top: 20px; width: 1050px; height: 230px;">
			<td>
				<div id="Univer" style="background-color: #0000b2;"></div>
			</td>
		</tr>
		<tr style="position: relative; top: 20px; width: 1050px; height: 230px;">
			<td>
				<div id="Univer" style="background-color: #ff4d4d;"></div>
			</td>
		</tr>
		<tr style="position: relative; top: 20px; width: 1050px; height: 230px;">
			<td>
				<div id="Univer" style="background-color: #a64dff;"></div>
			</td>
		</tr>
	</table>
	<table id="questInfoTable" style="position: absolute; left: 225px; top: 700px; width: 1050px;">
		<tr style="width: 1050px; height: 230px;">
			<td>
				<table style="width: 1050px; height: 230px;">
					<tr>
						<td style="width: 60px;">
							<div class="Txt_Univ">
								<p class="lastNode">Ф э н т е з и</p>
							</div>
						</td>
						<td style="width: 270px; text-align: center;">
							<img id="QPict" src="images/img_quest1.png" alt="quest1 pict"/>
						</td>
						<td style="width: 630px; height: 230px;">
							<table>
								<tr>
									<td>
										<div class="Txt_Квест">
											<p class="lastNode">Квест 1</p>
										</div>
									</td>
								</tr>
								<tr>
									<td>
										<div class="Txt_Автор">
											<p class="lastNode">Автор: Некто1<br />Вселенная: Фэнтези<br />Категория: Ориджиналы<br />Жанр: Повседневность, Юмор, Романтика<br />Описание: Путешествие по стране эльфов.
											</p>
										</div>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr style="position: relative; width: 1050px; height: 230px;">
			<td>
				<table style="width: 1050px; height: 230px;">
					<tr>
						<td style="width: 60px;">
							<div class="Txt_UnivFc">
								<p class="lastNode">Ф а н т а с т и к а</p>
							</div>
						</td>
						<td style="width: 270px; text-align: center;">
							<img id="QPict" src="images/img_quest2.png" alt="quest2 pict"/>
						</td>
						<td style="width: 630px; height: 230px;">
							<table>
								<tr>
									<td>
										<div class="Txt_Квест">
											<p class="lastNode">Квест 2</p>
										</div>
									</td>
								</tr>
								<tr>
									<td>
										<div class="Txt_Автор">
											<p class="lastNode">Автор: Некто2<br />Вселенная: Фэнтези<br />Категория: Ориджиналы<br />Жанр: Повседневность, Юмор, Романтика<br />Описание: Путешествие по стране эльфов.
											</p>
										</div>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr style="position: relative; width: 1050px; height: 230px;">
			<td>
				<table style="width: 1050px; height: 230px;">
					<tr>
						<td style="width: 60px;">
							<div class="Txt_Univ">
								<p class="lastNode">Р е а л и т и</p>
							</div>
						</td>
						<td style="width: 270px; text-align: center;">
							<img id="QPict" src="images/img_quest3.png" alt="quest3 pict"/>
						</td>
						<td style="width: 630px; height: 230px;">
							<table>
								<tr>
									<td>
										<div class="Txt_Квест">
											<p class="lastNode">Квест 3</p>
										</div>
									</td>
								</tr>
								<tr>
									<td>
										<div class="Txt_Автор">
											<p class="lastNode">Автор: Некто3<br />Вселенная: Фэнтези<br />Категория: Ориджиналы<br />Жанр: Повседневность, Юмор, Романтика<br />Описание: Путешествие по стране эльфов.
											</p>
										</div>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr style="position: relative; width: 1050px; height: 230px;">
			<td>
				<table style="width: 1050px; height: 230px;">
					<tr>
						<td style="width: 60px;">
							<div class="Txt_Univ">
								<p class="lastNode">И н о е</p>
							</div>
						</td>
						<td style="width: 270px; text-align: center;">
							<img id="QPict" src="images/img_quest4.png" alt="quest4 pict"/>
						</td>
						<td style="width: 630px; height: 230px;">
							<table>
								<tr>
									<td>
										<div class="Txt_Квест">
											<p class="lastNode">Квест 4</p>
										</div>
									</td>
								</tr>
								<tr>
									<td>
										<div class="Txt_Автор">
											<p class="lastNode">Автор: Некто4<br />Вселенная: Фэнтези<br />Категория: Ориджиналы<br />Жанр: Повседневность, Юмор, Романтика<br />Описание: Путешествие по стране эльфов.
											</p>
										</div>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
</div>
</body>
<script>
	$.ajax({
		type: "POST",
		url: '/author',
		dataType: 'json',
		data: { type: 'id', value: url2id() }
	}).done(function(data) {
		console.log(data);
		var author = JSON.parse(JSON.stringify(data));
		//console.log(jsonMainQuests);
		initAuthor(author);
	});

	function url2id() {
		var url = window.location.href.toString();
		var pos = url.lastIndexOf('/');
		return url.substring(pos + 1);
	}

	function initAuthor(author) {
		document.getElementById("Ava").setAttribute("src", "/images/author/" + author.avatarURL);
		console.log(document.getElementById("Ava").getAttribute("src"));
		document.getElementById("authorLogin").innerHTML = author.login;
		document.getElementById("authorDescription").innerHTML
			= author.description + "<br>"
			+ "Создано квестов: " + author.quests.length;

		$("#whiteBackGroundTable").empty();
		$("#univerTable").empty();
		$("#questInfoTable").empty();
		for (var i = 0; i < author.quests.length; i++) {
			var quest = author.quests[i];
			addWhiteChild();
			addUniverChild(quest.universeID);
			addQuestChild(quest);
		}
	}

	function addWhiteChild() {
		var whiteTable = document.getElementById("whiteBackGroundTable");
		var tr = whiteTable.insertRow(whiteTable.rows.length);
		tr.setAttribute("style", "position: relative; top: 20px; width: 1050px; height: 230px;");

		var divObj = document.createElement("div");
		divObj.setAttribute("id", "Div7");

		var td = tr.insertCell(0);
		td.appendChild(divObj);
	}

	function addUniverChild(universeID) {
		var backColors = ["#00b200", "#0000b2", "#ff4d4d", "#a64dff"];

		var whiteTable = document.getElementById("univerTable");
		var tr = whiteTable.insertRow(whiteTable.rows.length);
		tr.setAttribute("style", "position: relative; top: 20px; width: 1050px; height: 230px;");

		var divObj = document.createElement("div");
		divObj.setAttribute("id", "Univer");
		divObj.setAttribute("style", "background-color: " + backColors[universeID - 1] + ";");

		var td = tr.insertCell(0);
		td.appendChild(divObj);
	}

	function addQuestChild(quest) {
		var questTable = document.getElementById("questInfoTable");

		var questRow = questTable.insertRow(questTable.rows.length);
		questRow.setAttribute("style", "width: 1050px; height: 230px;");

		var innerTable = document.createElement("table");
		innerTable.setAttribute("style", "width: 1050px; height: 230px;");

		var infoRow = innerTable.insertRow(0);

		var universeCell = infoRow.insertCell(0);
		universeCell.setAttribute("style", "width: 60px;");
		var universeDiv = document.createElement("div");
		universeDiv.setAttribute("class", quest.universeID == 2 ? "Txt_UnivFc" : "Txt_Univ");
		var universeText = document.createElement("p");
		universeText.setAttribute("class", "lastNode");
		universeText.innerHTML = quest.universe.split("").join(" ");
		universeDiv.appendChild(universeText);
		universeCell.appendChild(universeDiv);

		var imageCell = infoRow.insertCell(1);
		imageCell.setAttribute("style", "width: 270px; text-align: center;");
		var questImage = document.createElement("img");
		questImage.setAttribute("id", "QPict");
		questImage.setAttribute("src", "/images/quest/" + quest.imageURL);
		questImage.setAttribute("alt", "quest pict");
		imageCell.appendChild(questImage);

		var textCell = infoRow.insertCell(2);
		textCell.setAttribute("style", "width: 630px; height: 230px;");
		var textTable = document.createElement("table");
		var questNameCell = textTable.insertRow(0).insertCell(0);
		var questNameDiv = document.createElement("div");
		questNameDiv.setAttribute("class", "Txt_Квест");
		var questNameParagraph = document.createElement("p");
		questNameParagraph.setAttribute("class", "lastNode");

		var questHref = document.createElement('a');
		questHref.href = window.location.protocol + "//" + window.location.host + "/quest/" + quest.id;
		questHref.innerHTML = quest.name;

		questNameParagraph.innerHTML = questHref.outerHTML;
		questNameDiv.appendChild(questNameParagraph);
		questNameCell.appendChild(questNameDiv);

		var questDescCell = textTable.insertRow(1).insertCell(0);
		var questDescDiv = document.createElement("div");
		questDescDiv.setAttribute("class", "Txt_Автор");
		var questDescParagraph = document.createElement("p");
		questDescDiv.appendChild(questDescParagraph);
		questDescParagraph.setAttribute("class", "lastNode");

		var authorHref = document.createElement('a');
		authorHref.href = window.location.protocol + "//" + window.location.host + "/author/" + quest.authorID;
		authorHref.innerHTML = quest.author;

		questDescParagraph.innerHTML
			= "Автор: " + authorHref.outerHTML + "<br>"
			+ "Категория: " + quest.category + "<br>"
			+ "Жанр: " + quest.genre
			+ (("description" in quest) ? ("<br>" + "Описание: " + ellipsize(quest.description)) : "");
		questDescCell.appendChild(questDescDiv);
		textCell.appendChild(textTable);

		var td = questRow.insertCell(0);
		td.appendChild(innerTable);
	}

	function ellipsize(s) {
		if (s.length > 32) {
			return s.substring(0, 32) + "...";
		}
		return s;
	}
</script>
</html>f
