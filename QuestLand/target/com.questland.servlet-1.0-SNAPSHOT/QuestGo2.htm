<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>QLand</title>
	<link rel="stylesheet" type="text/css" href="/css/questgo.css" media="all" />
	<script src="/js/jquery-1.11.2.min.js"></script>
	<!--[if IE]>
	<style type="text/css" media="all">.borderitem {border-style: solid;}</style>
	<![endif]-->
</head>

<body id="bodyID">
<div id="main">
	<div id="Div">
	</div>
	<div id="Div2">
	</div>
	<div id="Div3">
	</div>
	<div id="Div4">
	</div>
	<div id="Div5">
	</div>
	<div class="Txt_Главная">
	
		<p class="lastNode"><a href="/Main.htm">Главная</a>
		</p>
	</div>
	<div class="Txt_Популярное">
	
		<p class="lastNode">Популярное
		</p>
	</div>
	<div class="Txt_Правила">
	
		<p class="lastNode"><a href="/Rules.htm">Правила</a>
		</p>
	</div>
	<div class="Txt_Авторы">
	
		<p class="lastNode">Авторы
		</p>
	</div>
	<div class="Txt_Квесты">
	
		<p class="lastNode">Квесты
		</p>
	</div>
	<div class="clearFloat"></div>
	<div id="Div6">
	</div>
	<table id="mainTable" style="position: absolute; top: 150px; left: 225px; margin-left: 50px;">
		<tr>
			<td colspan="2">
				<div id="capture" class="Txt_QInfo">Shersh/It Is Fantastic Quest!/+10/page 1</div>
			</td>
		</tr>
		<tr>
			<td style="text-align: center; width: 600px">
				<img id="QuestPict" src = "images/quest2_img1.png" alt = "quest picture"></img> 
			</td>
			<td>
				<div class="Txt_Descr1">
					<p id="smallDesc" class="lastNode">Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля.
					</p>
				</div>
			</td>
		</tr>
		<tr>
			<td colspan="2"><div class="Txt_Descr2">
	
				<p id="bigDesc" class="lastNode">Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля. Наступил 2056 год, человечество только начинает активно строить межзвездные корабли и посещать новые системы. Вы - один из участников экспедиции к звезде Альфа. Вы помните сборы в дорогу, старт корабля и первые часы полета. На этом ваша память обрывается. Сейчас вы находитесь в коридоре космического корабля.
				</p>
			</div></td>
		</tr>
		<tr id="rbRow1" class="SelectNext"><td class="Txt_Variants"><input id="rb1" type="radio" name="group1" value="1"> Пойти вперед</td></tr>
		<tr id="rbRow2" class="SelectNext"><td class="Txt_Variants"><input id="rb2" type="radio" name="group1" value="2"> Пойти назад</td></tr>
		<tr id="rbRow3" class="SelectNext"><td class="Txt_Variants"><input id="rb3" type="radio" name="group1" value="3"> Сесть на пол и сокрушаться</td></tr>
		<tr id="rbRow4" class="SelectNext"><td class="Txt_Variants"><input id="rb4" type="radio" name="group1" value="4"> Биться головой о стену</td></tr>
		<tr id="rbRow5" class="SelectNext"><td class="Txt_Variants"><input id="rb5" type="radio" name="group1" value="5"> Попытаться вспомнить, что произошло ранее</td></tr>
		<tr id="buttonRow" class="SelectNext"><td><button onclick="nextSituation()" style="font-size: 300%; color: #265aff; background-color: #fff; width: 150px; margin-left: 50px">Готово!</button></td></tr>
	</table>
	<div class="clearFloat"></div>
	<div id="SmallPict">
	</div>
	<div class="Txt_Myname">
	
		<p class="lastNode">Rozettka
		</p>
	</div>
	<div id="Create">
	</div>
	<div class="Txt_Create">
	
		<p class="lastNode">Создать <br/> квест
		</p>
	</div>
	<div id="Watch">
	</div>
	<div class="Txt_Watch">
	
		<p class="lastNode">Мои <br/> квесты
		</p>
	</div>
	<div id="Start">
	</div>
	<div class="Txt_Start">
	
		<p class="lastNode">Завершить <br/> квест
		</p>
	</div>
	<div id="Show">
	</div>
	<div class="Txt_Show">
	</div>
	<div class="Txt_Like">&hearts;</div>
	<div class="Txt_Dislike">&hearts;</div>
	<div class="Txt_QuestLand">
	
		<p class="lastNode">Q u e s t L a n d
		</p>
	</div>
	<div class="clearFloat"></div>
</div>
</body>

<script>
	var currentSituation = 1;

	(function init() {
		$.ajax({
			type: "POST",
			url: '/quest',
			dataType: 'json',
			data: { type: 'id', value: url2id() }
		}).done(function(data) {
			console.log("quest: " + data);
			var quest = JSON.parse(JSON.stringify(data));
			var rate = quest.rateLike - quest.rateDislike;
			document.getElementById("capture").innerHTML
				= quest.author + "/" + quest.name + "/"
				+ (rate > 0 ? '+' : '') + rate + "/page 1";

			var fons = ["fon_fanz.png", "fon_fant.png", "fon_real.png", "fon_alter.png"];
			document.getElementById("bodyID").setAttribute("background", "/images/" + fons[quest.universeID - 1]);
			console.log(document.getElementById("bodyID").getAttribute("background"));
			update(0);
		});
	})();

	function update(next) {
		$.ajax({
			type: "POST",
			url: '/questgo',
			dataType: 'json',
			data: { type: 'id', questValue: url2id(), situationValue: currentSituation, nextMove: next }
		}).done(function(data) {
			console.log(data);
			var situation = JSON.parse(JSON.stringify(data));
			currentSituation = situation.situationID;
			//console.log(jsonMainQuests);
			initSituation(situation);
		});
	}

	function url2id() {
		var url = window.location.href.toString();
		var pos = url.lastIndexOf('/');
		console.log(url.substring(pos + 1));
		return url.substring(pos + 1);
	}

	function initSituation(situation) {
		document.getElementById("QuestPict").setAttribute("src", "/images/quest/" + situation.imageURL);
		document.getElementById("smallDesc").innerHTML = (situation.smallDescription ? situation.smallDescription : "");
		document.getElementById("bigDesc").innerHTML = (situation.bigDescription ? situation.bigDescription : "");
		for (var i = 1; i <= 5; i++) {
			var rbRow = document.getElementById("rbRow" + i);
			if (!rbRow) break;
			rbRow.parentNode.removeChild(rbRow);
		}

		var mainTable = document.getElementById("mainTable");
		for (var i = 0; i < situation.choices.length; i++) {
			var rbRow = mainTable.insertRow(3 + i);
			rbRow.setAttribute("id", "rbRow" + (i + 1));
			rbRow.setAttribute("class", "SelectNext");
			var rbCell = rbRow.insertCell(0);
			rbCell.setAttribute("class", "Txt_Variants");
			var rb = document.createElement("input");
			rb.setAttribute("id", "rb" + (i + 1));
			rb.setAttribute("type", "radio");
			rb.setAttribute("name", "group1");
			rb.setAttribute("value", (i + 1).toString());
			rbCell.innerHTML = rb.outerHTML + " " + situation.choices[i]
		}

		if (i == 0) {
			var rowButton = document.getElementById("buttonRow");
			rowButton.parentNode.removeChild(rowButton);
		}
	}

	function nextSituation() {
		var next = 0;
		for (var i = 1; i <= 5; i++) {
			var rb = document.getElementById("rb" + i);
			if (!rb) break;
			if (rb.checked) {
				next = i;
				break;
			}
		}

		if (next != 0) {
			update(next);
		}
	}
</script>

</html>