<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; margin:0px; padding:0px;">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>QLand</title>
	<link rel="stylesheet" type="text/css" href="/css/quest.css" media="all" />
	<script src="/js/jquery-1.11.2.min.js"></script>
	<script src="/js/utils.js"></script>
	<!--[if IE]>
	<style type="text/css" media="all">.borderitem {border-style: solid;}</style>
	<![endif]-->
</head>

<body id="bodyID" style="background-size: cover; margin: 0px; padding: 0px;">
	<table style="width: 100%; text-align: center; align: center;">
		<tr>
			<td style="width: 15%;">
			</td>
			<td style="width: 70%; height: 40px;">
				<table style="width: 100%; height: 100%; text-align: center; padding-top: 1%;">
					<tr style="height: 100%;">
						<td style="position: relative; width: 20%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									<a href="/Main.htm">Главная</a>
								</div>
							</div>
						</td>
						<td style="position: relative; width: 20%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									Квесты
								</div>
							</div>
						</td>
						<td style="position: relative; width: 22%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									<a href="/Popular.htm">Популярное</a>
								</div>
							</div>
						</td>
						<td style="position: relative; width: 18%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									<a href="/Authors.htm">Авторы</a>
								</div>
							</div>
						</td>
						<td style="position: relative; width: 20%; text-align: center; vertical-align: middle;">
							<div class="main_menu_block">
								<div class="txt_main_menu">
									<a href="/Rules.htm">Правила</a>
								</div>
							</div>
						</td>
					</tr>
				</table>
			</td>
			<td style="width: 15%;">
			</td>
		</tr>
		<tr>
			<td rowspan="2" style="width: 15%; vertical-align: top;">
				<div class="Txt_qland">
					Q u e s t L a n d
				</div>
			</td>
			<td style="width: 70%; padding-bottom: 3%;">
				<div style="border-radius: 50px; box-shadow: -10px 10px 50px 15px black; background-color: #fff; padding-bottom: 3%;">
					<table style="width: 100%; text-align: center; margin-top: 2%; height: 100%;">
						<tr style="height: 100px; width: 100%;">
							<td colspan="2" style="width: 100%;">
								<table style="width: 100%;">
									<tr style="height: 60px;">
										<td style="width: 90%; text-align: left; padding-left: 10px;">
											<div id="qName" class="Txt_QName">
												It Is Fantastic Quest!!!!!!!!!!!!!!!!!!!!!
											</div>
										</td>
										<td colspan="2" style="width: 10%;  padding-right: 10px;">
											<div id="qRate" class="Txt_QMark">
												+10
											</div>
										</td>
									<tr/>
									<tr style="height: 40px;">
										<td style="width: 90%; text-align: left; padding-left: 10px;">
											<div id="qAuthor" class="Txt_QAuthor">
												Автор: Shersh
											</div>
										</td>
										<td style="width: 5%;">
											<div id="hLike" class="Txt_QLike" onclick="setLike(1)" style="display: none;">
												&hearts;
											</div>
										</td>
										<td style="width: 5%;">
											<div id="hDislike" class="Txt_QDislike" onclick="setLike(-1)" style="display: none;">
												&hearts;
											</div>
										</td>
									</tr>
								</table>
							</td>
						</tr>
						<tr>
							<td style= "height: 100%; text-align: center; padding-left: 10px; padding-right: 10px;">
								<div>
									<img id="qImg" src="images/img_quest2.png" alt="author pict" style="position: relative; float: left; margin: 2% 2% 2% 2%; max-height: 450px; max-width: 550px; height: auto; width: auto;"/>
								</div>
								<div style="text-align: left; vertical-align: top; padding-top: 2%; padding-right:2%ж">
									<div id="qDesc" class="Txt_auth_about">
										Вселенная: Фантастика<br>Категория: Мультфильмы<br>Жанр: Повседневность, Юмор, Драма<br>Описвание: Мир высоких технологий. Роботы, космические корабли, искусственный интеллект ждут вас.
									</div>
								</div>
							</td>
						</tr>
					</table>
				</div>
			</td>
			<td rowspan="2" style="width: 15%; text-align: center; vertical-align: top;">
				<table style="height: 510px; width: 80%; margin-left: 10%;">
					<tr>
						<td style="height: 22%; width: 100%; text-align: center;">
							<div id="authorImgBox" style="display: none">
								<img id="authorImg" src="images/author.png" alt="author pict" style="position: relative; max-height: 100px; max-width: 100px; height: auto; width: auto;"/>
							</div>
						</td>
					</tr>
					<tr>
						<td style="height: 10%;">
							<div id="authorName" style="font-family: 'Hobo Std', Arial, Helvetica, sans-serif; font-size: 200%;	text-align: center;	color: #fff; text-shadow: 5px 2px 3px black;
										line-height: 100%; padding-bottom: 2px; padding-top: 1px; display: none">
								Rozettka
							</div>
						</td>
					</tr>
					<tr>
						<td style="height: 17%;">
							<div id="crQuest" class="auth_menu_block" style="display: none">
								<div class="txt_auth_menu">
									Создать <br> квест
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td style="height: 17%;">
							<div id="stQuest" class="auth_menu_block" style="display: none" onclick="startQuest()">
								<div class="txt_auth_menu">
									Начать <br> квест
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td style="height: 17%;">
							<div id="commQuest" class="auth_menu_block" style="display: none">
								<div class="txt_auth_menu">
									Открыть <br> отзывы
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td style="height: 17%;">
							<div id="logoutUser" onclick="exitUser()" class="auth_menu_block" style="display: none">
								<div class="txt_auth_menu" style="padding-top: 15%;">
									Выйти
								</div>
							</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

<script>
	function init() {
		$.ajax({
			type: "POST",
			url: '/quest',
			dataType: 'json',
			data: { type: 'id', value: url2id() }
		}).done(function(data) {
			console.log(data);
			var quest = JSON.parse(JSON.stringify(data));
			//console.log(jsonMainQuests);
			initQuest(quest);
			validateLogin({"questForm": ["#stQuest", "#commQuest", "#hLike", "#hDislike"]});
		});
	}

	init();

	function initQuest(quest) {
		document.getElementById("qName").innerHTML = quest.name;
		document.getElementById("qRate").innerHTML = (quest.rate > 0 ? '+' : '') + quest.rate;

		var authorHref = document.createElement('a');
		authorHref.href = window.location.protocol + "//" + window.location.host + "/author/" + quest.authorID;
		authorHref.innerHTML = quest.author;

		document.getElementById("qAuthor").innerHTML = "Автор: " + authorHref.outerHTML;
		document.getElementById("qDesc").innerHTML
			= "Вселенная: " + quest.universe + "<br>"
			+ "Категория: " + quest.category + "<br>"
			+ "Жанр: " + quest.genre
			+ (("characters" in quest) ? ("<br>" + "Персонажи: " + quest.characters) : "")
			+ (("description" in quest) ? ("<br>" + "Описание: " + quest.description) : "");
		document.getElementById("qImg").setAttribute("src", "/images/" + (quest.imageURL ? "quest/" + quest.imageURL : "none.png"));

		var fons = ["fon_fanz.png", "fon_fant.png", "fon_real.png", "fon_alter.png"];
		console.log(fons[quest.universeID - 1]);
		$("#bodyID").css("background-image", "url(/images/" + fons[quest.universeID - 1] + ")")
					.css("background-repeat", "no-repeat");
	}

	function startQuest() {
		window.location =  window.location.protocol + "//" + window.location.host + "/questgo/" + url2id();
	}

	function setLike(val) {
		$.ajax({
			type: 'POST',
			url: '/author',
			dataType: 'json',
			data: {
				type: 'rate',
				aVal: user.id,
				qVal: url2id(),
				rVal: val
			}
		}).done(function(q) {
			console.log("getting quest likes: " + q);
			document.getElementById("qRate").innerHTML = (q.rate > 0 ? '+' : '') + q.rate;
		});
	}
</script>

</body>
</html>